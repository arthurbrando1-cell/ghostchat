<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Web Clone</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .chat-bg { background-color: #efeae2; background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d4cfc6' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"); }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .message-out { background-color: #d9fdd3; }
        .message-in { background-color: #ffffff; }
        .message-out::after { content: ''; position: absolute; right: -8px; top: 0; border-width: 8px; border-style: solid; border-color: #d9fdd3 transparent transparent transparent; }
        .message-in::after { content: ''; position: absolute; left: -8px; top: 0; border-width: 8px; border-style: solid; border-color: #ffffff transparent transparent transparent; }
        .typing-indicator span { animation: blink 1.4s infinite both; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes blink { 0%, 60%, 100% { opacity: 0; } 30% { opacity: 1; } }
        .online-dot { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body class="bg-[#111b21] h-screen overflow-hidden">
    <!-- Login Screen -->
    <div id="loginScreen" class="flex items-center justify-center h-screen">
        <div class="bg-[#202c33] p-8 rounded-lg shadow-2xl w-96">
            <div class="flex items-center justify-center mb-6">
                <svg class="w-16 h-16 text-[#00a884]" viewBox="0 0 39 39" fill="currentColor">
                    <path d="M10.7 32.8l.6.3c2.5 1.5 5.3 2.2 8.1 2.2 8.8 0 16-7.2 16-16 0-4.2-1.7-8.3-4.7-11.3s-7-4.7-11.3-4.7c-8.8 0-16 7.2-15.9 16.1 0 3 .9 5.9 2.4 8.4l.4.6-1.6 5.9 6-1.5z"></path>
                    <path fill="#fff" d="M32.4 6.4C29 2.9 24.3 1 19.5 1 9.3 1 1.1 9.3 1.2 19.4c0 3.2.9 6.3 2.4 9.1L1 38l9.7-2.5c2.7 1.5 5.7 2.2 8.7 2.2 10.1 0 18.3-8.3 18.3-18.4 0-4.9-1.9-9.5-5.3-12.9zM19.5 34.6c-2.7 0-5.4-.7-7.7-2.1l-.6-.3-5.8 1.5L6.9 28l-.4-.6c-1.5-2.4-2.3-5.2-2.3-8 0-8.4 6.8-15.2 15.3-15.2 4.1 0 7.9 1.6 10.8 4.5 2.9 2.9 4.5 6.7 4.5 10.8-.1 8.4-6.9 15.1-15.3 15.1zm8.4-11.3c-.5-.2-2.7-1.3-3.1-1.5-.4-.2-.7-.2-1 .2-.3.5-1.2 1.5-1.5 1.8-.3.3-.5.3-1 .1s-2-0.7-3.8-2.3c-1.4-1.2-2.3-2.8-2.6-3.2-.3-.5 0-.7.2-1 .2-.2.5-.5.7-.8.2-.3.3-.5.5-.8.2-.3.1-.6 0-.8-.1-.2-1-2.4-1.4-3.3-.4-.9-.7-.8-1-.8-.3 0-.6 0-.9 0s-.8.1-1.3.6-1.6 1.6-1.6 3.9 1.7 4.5 1.9 4.8c.2.3 3.3 5 7.9 7 1.1.5 2 .8 2.6 1 1.1.3 2.1.3 2.9.2.9-.1 2.7-1.1 3.1-2.2.4-1.1.4-2 .3-2.2-.1-.2-.4-.3-.9-.5z"></path>
                </svg>
            </div>
            <h1 class="text-2xl font-light text-white text-center mb-6">WhatsApp Web</h1>
            <div class="space-y-4">
                <input type="text" id="userName" placeholder="Seu nome" 
                    class="w-full px-4 py-3 bg-[#2a3942] text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-[#00a884] placeholder-gray-400">
                <input type="tel" id="userPhone" placeholder="Seu telefone (ex: 11999999999)" 
                    class="w-full px-4 py-3 bg-[#2a3942] text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-[#00a884] placeholder-gray-400">
                <button onclick="login()" 
                    class="w-full py-3 bg-[#00a884] text-white rounded-lg hover:bg-[#02906f] transition-colors font-medium">
                    Entrar
                </button>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden h-screen flex">
        <!-- Left Panel - Chats List -->
        <div class="w-[30%] min-w-[300px] bg-[#111b21] flex flex-col border-r border-[#222d34]">
            <!-- Header -->
            <div class="h-14 bg-[#202c33] flex items-center justify-between px-4">
                <div class="flex items-center gap-3">
                    <div id="myAvatar" class="w-10 h-10 rounded-full bg-[#6b7175] flex items-center justify-center text-white font-medium"></div>
                    <span id="myName" class="text-white text-sm"></span>
                </div>
                <div class="flex items-center gap-5 text-[#aebac1]">
                    <button onclick="showNewChat()" class="hover:text-white" title="Nova conversa">
                        <svg viewBox="0 0 24 24" class="w-6 h-6" fill="currentColor">
                            <path d="M19.005 3.175H4.674C3.642 3.175 3 3.789 3 4.821V21.02l3.544-3.514h12.461c1.033 0 2.064-1.06 2.064-2.093V4.821c-.001-1.032-1.032-1.646-2.064-1.646zm-4.989 9.869H7.041V11.1h6.975v1.944zm3-4H7.041V7.1h9.975v1.944z"></path>
                        </svg>
                    </button>
                    <button onclick="toggleMenu()" class="hover:text-white">
                        <svg viewBox="0 0 24 24" class="w-6 h-6" fill="currentColor">
                            <path d="M12 7a2 2 0 1 0-.001-4.001A2 2 0 0 0 12 7zm0 2a2 2 0 1 0-.001 3.999A2 2 0 0 0 12 9zm0 6a2 2 0 1 0-.001 3.999A2 2 0 0 0 12 15z"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Search -->
            <div class="p-2 bg-[#111b21]">
                <div class="flex items-center bg-[#202c33] rounded-lg px-4 py-2">
                    <svg viewBox="0 0 24 24" class="w-5 h-5 text-[#8696a0]" fill="currentColor">
                        <path d="M15.009 13.805h-.636l-.22-.219a5.184 5.184 0 0 0 1.256-3.386 5.207 5.207 0 1 0-5.207 5.208 5.183 5.183 0 0 0 3.385-1.255l.221.22v.635l4.004 3.999 1.194-1.195-3.997-4.007zm-4.808 0a3.605 3.605 0 1 1 0-7.21 3.605 3.605 0 0 1 0 7.21z"></path>
                    </svg>
                    <input type="text" id="searchInput" oninput="searchChats()" placeholder="Pesquisar ou começar uma nova conversa" 
                        class="bg-transparent text-white text-sm ml-4 w-full focus:outline-none placeholder-[#8696a0]">
                </div>
            </div>

            <!-- Chats List -->
            <div id="chatsList" class="flex-1 overflow-y-auto scrollbar-hide"></div>
        </div>

        <!-- Right Panel - Chat Area -->
        <div class="flex-1 flex flex-col">
            <!-- Empty State -->
            <div id="emptyState" class="flex-1 flex flex-col items-center justify-center bg-[#222e35]">
                <div class="text-center">
                    <svg class="w-[320px] h-[188px] mx-auto text-[#364147]" viewBox="0 0 303 172" fill="currentColor">
                        <path d="M229.565 160.229c32.647-16.166 54.391-50.161 54.391-89.073 0-55.098-45.022-99.775-100.554-99.775-34.178 0-64.377 17.14-82.298 43.249-4.829-.632-9.754-.964-14.759-.964C38.63 13.666 0 52.056 0 99.573c0 21.026 7.567 40.283 20.133 55.264-.874 6.676-3.876 14.264-8.963 22.396l-.27.467-.038.071c-.086.166-.166.338-.239.51-.217.485-.391.987-.531 1.5-.069.259-.13.535-.184.825l-.037.218-.014.094c-.063.417-.098.833-.107 1.264l-.002.06v.139c.009.621.059 1.247.146 1.882l.018.122.033.208c.084.511.21 1.017.37 1.523.029.091.059.187.092.283.098.287.209.57.332.854.147.333.32.673.517 1.012.092.159.19.32.294.48.174.271.371.546.589.82.132.167.27.339.42.513.136.158.279.32.43.484.086.093.175.188.27.284l.15.154c.24.24.499.472.769.69.129.106.26.21.396.311.093.069.187.137.283.203.169.118.34.231.516.34l.087.052c.037.021.076.042.113.064.106.06.212.12.321.178l.105.052c.11.055.222.106.335.157.062.028.124.054.187.08.112.046.225.089.338.131.076.028.153.054.229.081.109.037.219.071.329.104l.245.071c.106.029.212.056.319.081.117.028.234.053.352.077.086.018.172.034.259.049.135.024.27.045.407.063.092.012.184.024.276.034.109.011.219.021.329.028.145.01.289.017.434.02.096.001.192.002.288.001.211-.003.422-.015.633-.037l.099-.012c.722-.09 1.444-.262 2.168-.536.413-.156.846-.363 1.299-.627l.083-.047.043-.025.102-.062c10.636-6.391 23.559-11.139 37.81-13.203 6.402 1.334 13.041 2.034 19.846 2.034 7.039 0 13.897-.753 20.488-2.183.027.005.054.009.081.015l.073.014c10.96 1.603 21.264 4.726 30.538 8.93.111.053.22.1.326.14a6.21 6.21 0 00.656.223c.093.026.186.048.278.068.181.04.362.07.542.091l.158.014.143.009c.087.003.175.004.262.003l.068-.001c.106-.003.212-.009.318-.018.072-.007.144-.016.216-.027.112-.016.224-.037.337-.062.058-.013.115-.028.174-.045a3.008 3.008 0 00.479-.163l.069-.032c.074-.035.148-.073.223-.115l.135-.078c.05-.029.098-.06.148-.092.021-.013.041-.028.064-.042l.062-.044.087-.066.065-.052.073-.06.087-.078.1-.096c.05-.052.101-.105.149-.162l.045-.052c.061-.073.119-.147.175-.223.022-.029.041-.058.063-.088.038-.055.077-.111.112-.169a2.36 2.36 0 00.095-.161c.024-.046.048-.094.071-.14l.026-.055.05-.12.038-.097.023-.069.025-.081c.021-.072.04-.143.057-.216.006-.025.011-.053.016-.079a2.865 2.865 0 00.042-.282v-.003c.004-.04.008-.08.01-.121l.002-.028a3.544 3.544 0 00-.011-.354v-.006c-.004-.051-.01-.103-.018-.155l-.004-.028a2.624 2.624 0 00-.118-.451l-.009-.028a2.618 2.618 0 00-.074-.188l-.013-.032a2.637 2.637 0 00-.117-.242l-.012-.022a3.41 3.41 0 00-.24-.384l-.051-.07a8.358 8.358 0 00-.126-.166c-.024-.029-.051-.058-.077-.088l-.046-.052c-.12-.127-.238-.237-.347-.327l-.032-.024a6.17 6.17 0 00-.11-.077c-.04-.027-.08-.052-.12-.076-.051-.03-.102-.059-.152-.085-.03-.016-.06-.03-.089-.044-.025-.012-.05-.023-.074-.033-.077-.033-.152-.062-.224-.086-.056-.019-.111-.034-.165-.046a1.453 1.453 0 00-.246-.039l-.056-.003c-.032-.001-.063-.001-.093 0a.823.823 0 00-.091.008c-.019.002-.038.006-.056.009l-.093.02c-.029.008-.058.018-.087.029l-.055.022c-.038.016-.076.035-.113.056l-.046.027c-.067.042-.132.093-.196.152l-.028.025c-.063.06-.127.132-.196.22-.031.039-.063.082-.097.128a4.256 4.256 0 00-.123.186 4.791 4.791 0 00-.2.362l-.053.112a.827.827 0 01-.029.06c-10.521 21.426-35.194 36.153-63.267 36.153-8.036 0-15.727-1.209-22.89-3.462l-.122-.039-.061-.02-.059-.02-.049-.017-.148-.052-.074-.028-.053-.021c-.138-.055-.275-.114-.412-.178l-.038-.019-.161-.079-.033-.017a8.97 8.97 0 01-.507-.29l-.007-.005c-.034-.021-.069-.042-.103-.065l-.057-.037c-.025-.017-.05-.034-.076-.052a6.149 6.149 0 01-.208-.152c-.052-.039-.104-.081-.158-.124-.024-.02-.048-.04-.074-.061-.043-.037-.087-.076-.132-.117-.019-.017-.04-.035-.059-.054a4.714 4.714 0 01-.243-.245l-.038-.042-.035-.04a4.39 4.39 0 01-.168-.202 5.247 5.247 0 01-.337-.475l-.021-.034-.058-.098a6.578 6.578 0 01-.177-.323l-.009-.019c-.042-.084-.085-.172-.126-.264a7.326 7.326 0 01-.147-.35 9.71 9.71 0 01-.318-.934 13.322 13.322 0 01-.168-.674c-.027-.124-.053-.25-.076-.378a16.073 16.073 0 01-.063-.372l-.048-.344-.037-.305c-.021-.207-.037-.414-.048-.621l-.007-.162-.008-.323v-.161c.001-.185.006-.37.016-.555l.005-.121c.007-.151.017-.302.03-.452l.004-.05.016-.173c.01-.096.02-.191.033-.286l.007-.054.021-.153c.018-.125.039-.249.062-.373l.025-.124c.022-.109.046-.217.073-.325l.032-.127a8.64 8.64 0 01.208-.671l.006-.016c.044-.129.092-.257.144-.385l.043-.102c.035-.082.072-.163.111-.245l.025-.051c.046-.097.095-.193.147-.289l.035-.065.038-.068c.041-.074.084-.148.129-.221l.043-.07.05-.079c.047-.073.097-.147.148-.219l.043-.062c.069-.097.142-.194.218-.29l.003-.004c.161-.203.336-.401.524-.593l.018-.018.03-.03c.073-.073.149-.145.226-.216l.054-.048a8.08 8.08 0 01.339-.283l.028-.021c.078-.062.158-.122.24-.18l.055-.039.044-.03c.107-.073.217-.143.33-.209l.02-.011.048-.028c.1-.058.203-.113.308-.165l.05-.025c.089-.043.179-.083.271-.121l.017-.007c.105-.043.212-.082.32-.117l.038-.012c.09-.029.18-.054.271-.077l.049-.012c.103-.025.206-.045.31-.062l.022-.003c.115-.018.23-.03.346-.036l.048-.002c.063-.002.126-.003.189-.001h.001c.185.003.368.02.55.052l.049.01c.153.028.304.066.453.114l.039.014c.112.037.223.081.332.132l.023.011c.147.07.291.151.432.244l.002.002c.071.048.142.098.211.152l.03.024c.054.043.108.089.162.136l.034.031c.06.055.12.112.179.172l.023.023c.089.092.177.189.263.292l.02.023c.081.098.16.2.237.307l.007.011c.02.028.04.056.059.085.011.016.022.031.032.047.024.036.048.073.072.11.032.052.064.105.095.158l.036.062c.055.099.108.199.158.301l.022.047c.055.116.107.234.155.353l.011.028c.057.145.108.291.153.437l.014.05c.04.133.074.267.103.4l.009.043c.031.147.056.294.074.441l.006.046c.02.16.033.318.038.476v.028c.004.134.002.267-.006.399v.016a5.39 5.39 0 01-.036.399l-.004.032a6.146 6.146 0 01-.069.419l-.007.035a6.893 6.893 0 01-.088.389 7.77 7.77 0 01-.107.39l-.014.043c-.04.136-.084.271-.132.404l-.009.026c-.089.245-.194.484-.315.715l-.018.034a8.384 8.384 0 01-.396.684l-.011.017c-.075.115-.155.227-.239.336l-.01.012-.043.055c-.081.101-.166.198-.254.291l-.035.036c-.082.086-.168.168-.256.246l-.044.038-.05.042c-.078.065-.158.127-.24.186l-.056.04c-.092.065-.187.125-.284.181l-.039.022c-.105.061-.212.117-.321.168l-.048.022c-.096.045-.194.085-.293.121l-.041.015a4.66 4.66 0 01-.35.109l-.03.008c-.131.034-.264.061-.397.08h-.001c-.075.011-.15.019-.225.024l-.045.003c-.057.003-.115.005-.172.005-.05 0-.1-.001-.149-.004l-.04-.002a3.63 3.63 0 01-.215-.025l-.036-.006a3.384 3.384 0 01-.19-.039l-.011-.003a4.088 4.088 0 01-.518-.163c-9.62-3.671-18.076-9.011-25.001-15.549-6.106 3.919-11.521 8.608-16.121 13.835-.028.031-.055.063-.082.095l-.01.012-.073.087-.01.013c-.025.031-.05.062-.076.093l-.011.014-.039.05c-.024.032-.048.065-.073.098l-.014.019-.034.047-.073.104-.015.022-.068.099-.015.022-.065.099-.014.022-.062.098-.013.021-.06.098-.012.021-.057.097-.011.02a12.721 12.721 0 00-.166.299l-.011.022c-.018.034-.036.068-.053.102l-.011.022-.05.101-.011.022-.048.1-.01.022-.046.1-.01.023-.044.1-.009.022-.042.099-.009.023-.04.099-.008.023-.038.098-.008.023-.036.098-.008.023-.034.098-.007.023-.032.098-.007.023-.03.098-.006.023c-.01.032-.02.065-.029.098l-.006.023-.027.098-.006.024-.025.098-.005.024-.024.098-.005.024-.022.098-.004.024-.02.098-.004.024-.018.098-.004.025-.016.098-.003.025-.015.098-.003.025-.012.098-.003.025-.011.099-.002.025-.009.099-.002.025-.007.099-.002.025-.005.099-.001.026-.003.099-.001.026-.002.099v.052l.001.099.001.026.002.099.002.026.004.099.002.026.006.099.002.026.008.099.003.026.009.099.003.026.012.099.004.025.013.098.004.026.016.098.005.025.017.098.005.025.02.098.005.025.022.098.006.025.023.098.006.024.026.098.007.024.028.098.007.024.03.097.008.024.032.097.008.024.034.097.009.024.036.097.01.023.039.096.01.023.041.096.01.023.044.096.011.023.046.095.012.022.049.095.012.022.051.094.013.022.054.094.014.022.057.093.014.021.06.092.015.021.063.091.016.02.066.09.017.02.07.089.017.019.073.088.018.019.077.087.019.018.081.085.02.018.085.083.02.017c6.556 6.377 14.674 11.375 23.82 14.586l-.002.001z"></path>
                    </svg>
                    <h2 class="text-[#41525d] text-3xl font-light mt-10">WhatsApp Web</h2>
                    <p class="text-[#8696a0] mt-4 max-w-md">Envie e receba mensagens sem manter seu celular conectado.</p>
                </div>
            </div>

            <!-- Chat View (Hidden by default) -->
            <div id="chatView" class="hidden flex-1 flex flex-col">
                <!-- Chat Header -->
                <div class="h-14 bg-[#202c33] flex items-center justify-between px-4">
                    <div class="flex items-center gap-3 cursor-pointer" onclick="showContactInfo()">
                        <button class="md:hidden mr-2 text-[#aebac1]" onclick="closeChat(event)">
                            <svg viewBox="0 0 24 24" class="w-6 h-6" fill="currentColor">
                                <path d="M12 4l1.4 1.4L7.8 11H20v2H7.8l5.6 5.6L12 20l-8-8 8-8z"></path>
                            </svg>
                        </button>
                        <div id="chatAvatar" class="w-10 h-10 rounded-full bg-[#6b7175] flex items-center justify-center text-white font-medium"></div>
                        <div>
                            <h3 id="chatName" class="text-white font-medium"></h3>
                            <p id="chatStatus" class="text-[#8696a0] text-xs"></p>
                        </div>
                    </div>
                    <div class="flex items-center gap-5 text-[#aebac1]">
                        <button class="hover:text-white">
                            <svg viewBox="0 0 24 24" class="w-6 h-6" fill="currentColor">
                                <path d="M15.9 14.3H15l-.3-.3c1-1.1 1.6-2.7 1.6-4.3 0-3.7-3-6.7-6.7-6.7S3 6 3 9.7s3 6.7 6.7 6.7c1.6 0 3.2-.6 4.3-1.6l.3.3v.8l5.1 5.1 1.5-1.5-5-5.2zm-6.2 0c-2.6 0-4.6-2.1-4.6-4.6s2.1-4.6 4.6-4.6 4.6 2.1 4.6 4.6-2 4.6-4.6 4.6z"></path>
                            </svg>
                        </button>
                        <button class="hover:text-white">
                            <svg viewBox="0 0 24 24" class="w-6 h-6" fill="currentColor">
                                <path d="M12 7a2 2 0 1 0-.001-4.001A2 2 0 0 0 12 7zm0 2a2 2 0 1 0-.001 3.999A2 2 0 0 0 12 9zm0 6a2 2 0 1 0-.001 3.999A2 2 0 0 0 12 15z"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Messages Area -->
                <div id="messagesArea" class="flex-1 overflow-y-auto chat-bg p-4 scrollbar-hide"></div>

                <!-- Typing Indicator -->
                <div id="typingIndicator" class="hidden bg-[#202c33] px-4 py-2">
                    <span class="text-[#00a884] text-sm">digitando<span class="typing-indicator"><span>.</span><span>.</span><span>.</span></span></span>
                </div>

                <!-- Message Input -->
                <div class="bg-[#202c33] px-4 py-3 flex items-center gap-3">
                    <button class="text-[#8696a0] hover:text-[#aebac1]">
                        <svg viewBox="0 0 24 24" class="w-7 h-7" fill="currentColor">
                            <path d="M9.153 11.603c.795 0 1.439-.879 1.439-1.962s-.644-1.962-1.439-1.962-1.439.879-1.439 1.962.644 1.962 1.439 1.962zm-3.204 1.362c-.026-.307-.131 5.218 6.063 5.551 6.066-.25 6.066-5.551 6.066-5.551-6.078 1.416-12.129 0-12.129 0zm11.363 1.108s-.669 1.959-5.051 1.959c-3.505 0-5.388-1.164-5.607-1.959 0 0 5.912 1.055 10.658 0zM11.804 1.011C5.609 1.011.978 6.033.978 12.228s4.826 10.761 11.021 10.761S23.02 18.423 23.02 12.228c.001-6.195-5.021-11.217-11.216-11.217zM12 21.354c-5.273 0-9.381-3.886-9.381-9.159s3.942-9.548 9.215-9.548 9.548 4.275 9.548 9.548c-.001 5.272-4.109 9.159-9.382 9.159zm3.108-9.751c.795 0 1.439-.879 1.439-1.962s-.644-1.962-1.439-1.962-1.439.879-1.439 1.962.644 1.962 1.439 1.962z"></path>
                        </svg>
                    </button>
                    <button class="text-[#8696a0] hover:text-[#aebac1]">
                        <svg viewBox="0 0 24 24" class="w-7 h-7" fill="currentColor">
                            <path d="M1.816 15.556v.002c0 1.502.584 2.912 1.646 3.972s2.472 1.647 3.974 1.647a5.58 5.58 0 0 0 3.972-1.645l9.547-9.548c.769-.768 1.147-1.767 1.058-2.817-.079-.968-.548-1.927-1.319-2.698-1.594-1.592-4.068-1.711-5.517-.262l-7.916 7.915c-.881.881-.792 2.25.214 3.261.959.958 2.423 1.053 3.263.215l5.511-5.512c.28-.28.267-.722.053-.936l-.244-.244c-.191-.191-.567-.349-.957.04l-5.506 5.506c-.18.18-.635.127-.976-.214-.098-.097-.576-.613-.213-.973l7.915-7.917c.818-.817 2.267-.699 3.23.262.5.501.802 1.1.849 1.685.051.573-.156 1.111-.589 1.543l-9.547 9.549a3.97 3.97 0 0 1-2.829 1.171 3.975 3.975 0 0 1-2.83-1.173 3.973 3.973 0 0 1-1.172-2.828c0-1.071.415-2.076 1.172-2.83l7.209-7.211c.157-.157.264-.579.028-.814L11.5 4.36a.572.572 0 0 0-.834.018l-7.205 7.207a5.577 5.577 0 0 0-1.645 3.971z"></path>
                        </svg>
                    </button>
                    <div class="flex-1">
                        <input type="text" id="messageInput" placeholder="Digite uma mensagem" 
                            onkeypress="handleKeyPress(event)" oninput="handleTyping()"
                            class="w-full px-4 py-2 bg-[#2a3942] text-white rounded-lg focus:outline-none placeholder-[#8696a0]">
                    </div>
                    <button onclick="sendMessage()" class="text-[#8696a0] hover:text-[#aebac1]">
                        <svg viewBox="0 0 24 24" class="w-7 h-7" fill="currentColor">
                            <path d="M1.101 21.757L23.8 12.028 1.101 2.3l.011 7.912 13.623 1.816-13.623 1.817-.011 7.912z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- New Chat Modal -->
    <div id="newChatModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-[#202c33] rounded-lg w-96 max-h-[80vh] overflow-hidden">
            <div class="p-4 border-b border-[#374045]">
                <div class="flex items-center justify-between">
                    <h3 class="text-white text-lg">Nova conversa</h3>
                    <button onclick="hideNewChat()" class="text-[#aebac1] hover:text-white">
                        <svg viewBox="0 0 24 24" class="w-6 h-6" fill="currentColor">
                            <path d="M19.1 17.2l-5.3-5.3 5.3-5.3-1.8-1.8-5.3 5.4-5.3-5.3-1.8 1.7 5.3 5.3-5.3 5.3L6.7 19l5.3-5.3 5.3 5.3 1.8-1.8z"></path>
                        </svg>
                    </button>
                </div>
                <input type="text" id="newChatPhone" placeholder="Digite o telefone do contato"
                    class="w-full mt-4 px-4 py-2 bg-[#2a3942] text-white rounded-lg focus:outline-none placeholder-[#8696a0]">
            </div>
            <div id="usersList" class="overflow-y-auto max-h-80 scrollbar-hide"></div>
            <div class="p-4">
                <button onclick="startNewChat()" class="w-full py-2 bg-[#00a884] text-white rounded-lg hover:bg-[#02906f]">
                    Iniciar conversa
                </button>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC0DhQ-EUs3Azqn7_tbB-W3S9ko0DaUWls",
            authDomain: "ghostchat-app-3a3f0.firebaseapp.com",
            projectId: "ghostchat-app-3a3f0",
            storageBucket: "ghostchat-app-3a3f0.firebasestorage.app",
            messagingSenderId: "781582052854",
            appId: "1:781582052854:web:7fba6eae2a372ce0e22bd7",
            databaseURL: "https://ghostchat-app-3a3f0-default-rtdb.firebaseio.com"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // App State
        let currentUser = null;
        let currentChat = null;
        let chats = {};
        let users = {};
        let typingTimeout = null;

        // Check for existing session
        window.onload = function() {
            const savedUser = localStorage.getItem('whatsappUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainApp();
            }
        };

        // Login function
        function login() {
            const name = document.getElementById('userName').value.trim();
            const phone = document.getElementById('userPhone').value.trim().replace(/\D/g, '');
            
            if (!name || !phone) {
                alert('Por favor, preencha todos os campos');
                return;
            }

            currentUser = {
                id: phone,
                name: name,
                phone: phone,
                avatar: name.charAt(0).toUpperCase(),
                lastSeen: Date.now(),
                online: true
            };

            // Save user to Firebase
            database.ref('users/' + phone).set(currentUser);
            
            // Save to localStorage
            localStorage.setItem('whatsappUser', JSON.stringify(currentUser));

            showMainApp();
        }

        function showMainApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('flex');
            
            document.getElementById('myAvatar').textContent = currentUser.avatar;
            document.getElementById('myName').textContent = currentUser.name;

            // Set user online
            database.ref('users/' + currentUser.id).update({ 
                online: true, 
                lastSeen: Date.now() 
            });

            // Handle disconnect
            database.ref('users/' + currentUser.id).onDisconnect().update({
                online: false,
                lastSeen: Date.now()
            });

            // Load data
            loadUsers();
            loadChats();
        }

        function loadUsers() {
            database.ref('users').on('value', (snapshot) => {
                users = snapshot.val() || {};
                updateUsersList();
            });
        }

        function updateUsersList() {
            const usersList = document.getElementById('usersList');
            usersList.innerHTML = '';

            Object.values(users).forEach(user => {
                if (user.id !== currentUser.id) {
                    const userDiv = document.createElement('div');
                    userDiv.className = 'flex items-center gap-3 p-3 hover:bg-[#2a3942] cursor-pointer';
                    userDiv.onclick = () => {
                        document.getElementById('newChatPhone').value = user.phone;
                    };
                    userDiv.innerHTML = `
                        <div class="relative">
                            <div class="w-12 h-12 rounded-full bg-[#6b7175] flex items-center justify-center text-white text-lg">
                                ${user.avatar}
                            </div>
                            ${user.online ? '<div class="absolute bottom-0 right-0 w-3 h-3 bg-[#00a884] rounded-full border-2 border-[#202c33] online-dot"></div>' : ''}
                        </div>
                        <div class="flex-1">
                            <p class="text-white">${user.name}</p>
                            <p class="text-[#8696a0] text-sm">${user.phone}</p>
                        </div>
                    `;
                    usersList.appendChild(userDiv);
                }
            });
        }

        function loadChats() {
            database.ref('chats').orderByChild('participants/' + currentUser.id).equalTo(true).on('value', (snapshot) => {
                chats = snapshot.val() || {};
                renderChatsList();
            });
        }

        function renderChatsList() {
            const chatsList = document.getElementById('chatsList');
            chatsList.innerHTML = '';

            const chatArray = Object.entries(chats).map(([id, chat]) => ({
                id,
                ...chat,
                lastMessageTime: chat.lastMessage?.timestamp || 0
            })).sort((a, b) => b.lastMessageTime - a.lastMessageTime);

            chatArray.forEach(chat => {
                const otherUserId = Object.keys(chat.participants).find(id => id !== currentUser.id);
                const otherUser = users[otherUserId] || { name: otherUserId, avatar: '?' };
                
                const chatDiv = document.createElement('div');
                chatDiv.className = `flex items-center gap-3 p-3 hover:bg-[#202c33] cursor-pointer ${currentChat === chat.id ? 'bg-[#2a3942]' : ''}`;
                chatDiv.onclick = () => openChat(chat.id, otherUser);
                
                const lastMsg = chat.lastMessage || {};
                const time = lastMsg.timestamp ? formatTime(lastMsg.timestamp) : '';
                const unread = chat.unread?.[currentUser.id] || 0;
                
                chatDiv.innerHTML = `
                    <div class="relative">
                        <div class="w-12 h-12 rounded-full bg-[#6b7175] flex items-center justify-center text-white text-lg">
                            ${otherUser.avatar}
                        </div>
                        ${otherUser.online ? '<div class="absolute bottom-0 right-0 w-3 h-3 bg-[#00a884] rounded-full border-2 border-[#111b21] online-dot"></div>' : ''}
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex justify-between">
                            <span class="text-white font-medium truncate">${otherUser.name}</span>
                            <span class="text-[#8696a0] text-xs">${time}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <p class="text-[#8696a0] text-sm truncate">${lastMsg.text || ''}</p>
                            ${unread > 0 ? `<span class="bg-[#00a884] text-white text-xs rounded-full px-2 py-0.5">${unread}</span>` : ''}
                        </div>
                    </div>
                `;
                chatsList.appendChild(chatDiv);
            });
        }

        function getChatId(user1, user2) {
            return [user1, user2].sort().join('_');
        }

        function openChat(chatId, otherUser) {
            currentChat = chatId;
            
            document.getElementById('emptyState').classList.add('hidden');
            document.getElementById('chatView').classList.remove('hidden');
            document.getElementById('chatView').classList.add('flex');
            
            document.getElementById('chatAvatar').textContent = otherUser.avatar;
            document.getElementById('chatName').textContent = otherUser.name;
            
            // Update status
            updateChatStatus(otherUser);
            
            // Mark as read
            database.ref(`chats/${chatId}/unread/${currentUser.id}`).set(0);
            
            // Load messages
            loadMessages(chatId);
            
            // Listen for typing
            listenForTyping(chatId, otherUser.id);
            
            renderChatsList();
        }

        function updateChatStatus(otherUser) {
            const statusEl = document.getElementById('chatStatus');
            if (otherUser.online) {
                statusEl.textContent = 'online';
                statusEl.classList.add('text-[#00a884]');
            } else {
                statusEl.textContent = otherUser.lastSeen ? `visto por último ${formatLastSeen(otherUser.lastSeen)}` : '';
                statusEl.classList.remove('text-[#00a884]');
            }
        }

        function loadMessages(chatId) {
            const messagesArea = document.getElementById('messagesArea');
            
            database.ref(`messages/${chatId}`).orderByChild('timestamp').on('value', (snapshot) => {
                messagesArea.innerHTML = '';
                
                const messages = snapshot.val() || {};
                let lastDate = '';
                
                Object.values(messages).sort((a, b) => a.timestamp - b.timestamp).forEach(msg => {
                    const msgDate = formatDate(msg.timestamp);
                    
                    if (msgDate !== lastDate) {
                        lastDate = msgDate;
                        const dateDiv = document.createElement('div');
                        dateDiv.className = 'flex justify-center my-4';
                        dateDiv.innerHTML = `<span class="bg-[#182229] text-[#8696a0] text-xs px-3 py-1 rounded-lg">${msgDate}</span>`;
                        messagesArea.appendChild(dateDiv);
                    }
                    
                    const isMe = msg.senderId === currentUser.id;
                    const msgDiv = document.createElement('div');
                    msgDiv.className = `flex ${isMe ? 'justify-end' : 'justify-start'} mb-1`;
                    msgDiv.innerHTML = `
                        <div class="relative max-w-[65%] px-3 py-2 rounded-lg ${isMe ? 'message-out' : 'message-in'} shadow">
                            <p class="text-[#111b21] text-sm pr-12">${msg.text}</p>
                            <div class="absolute bottom-1 right-2 flex items-center gap-1">
                                <span class="text-[#667781] text-[11px]">${formatTime(msg.timestamp)}</span>
                                ${isMe ? getCheckmarks(msg.status) : ''}
                            </div>
                        </div>
                    `;
                    messagesArea.appendChild(msgDiv);
                });
                
                messagesArea.scrollTop = messagesArea.scrollHeight;
            });
        }

        function getCheckmarks(status) {
            if (status === 'read') {
                return '<svg viewBox="0 0 16 11" class="w-4 h-3 text-[#53bdeb]" fill="currentColor"><path d="M11.071.653a.457.457 0 0 0-.304-.102.493.493 0 0 0-.381.178l-6.19 7.636-2.405-2.272a.463.463 0 0 0-.336-.136.475.475 0 0 0-.347.147.473.473 0 0 0 .002.692l2.764 2.612a.478.478 0 0 0 .322.123h.041a.482.482 0 0 0 .344-.176l6.507-8.045a.464.464 0 0 0-.017-.657zm-5.107 7.636l-1.2-1.133a.463.463 0 0 0-.336-.136.475.475 0 0 0-.347.147.473.473 0 0 0 .002.692l1.559 1.472a.478.478 0 0 0 .322.123h.041a.482.482 0 0 0 .344-.176l.054-.066-.439-.923zm8.012-7.636a.457.457 0 0 0-.304-.102.493.493 0 0 0-.381.178l-6.19 7.636-1.028-.971-.439.923 1.103 1.041a.478.478 0 0 0 .322.123h.041a.482.482 0 0 0 .344-.176l6.549-8.097a.464.464 0 0 0-.017-.655z"></path></svg>';
            } else if (status === 'delivered') {
                return '<svg viewBox="0 0 16 11" class="w-4 h-3 text-[#667781]" fill="currentColor"><path d="M11.071.653a.457.457 0 0 0-.304-.102.493.493 0 0 0-.381.178l-6.19 7.636-2.405-2.272a.463.463 0 0 0-.336-.136.475.475 0 0 0-.347.147.473.473 0 0 0 .002.692l2.764 2.612a.478.478 0 0 0 .322.123h.041a.482.482 0 0 0 .344-.176l6.507-8.045a.464.464 0 0 0-.017-.657zm-5.107 7.636l-1.2-1.133a.463.463 0 0 0-.336-.136.475.475 0 0 0-.347.147.473.473 0 0 0 .002.692l1.559 1.472a.478.478 0 0 0 .322.123h.041a.482.482 0 0 0 .344-.176l.054-.066-.439-.923zm8.012-7.636a.457.457 0 0 0-.304-.102.493.493 0 0 0-.381.178l-6.19 7.636-1.028-.971-.439.923 1.103 1.041a.478.478 0 0 0 .322.123h.041a.482.482 0 0 0 .344-.176l6.549-8.097a.464.464 0 0 0-.017-.655z"></path></svg>';
            }
            return '<svg viewBox="0 0 12 11" class="w-3 h-3 text-[#667781]" fill="currentColor"><path d="M11.155.653a.457.457 0 0 0-.305-.102.493.493 0 0 0-.38.178L4.28 8.365 1.628 6.093a.463.463 0 0 0-.336-.136.475.475 0 0 0-.347.147.473.473 0 0 0 .002.692l2.764 2.612a.478.478 0 0 0 .322.123h.041a.482.482 0 0 0 .344-.176l6.507-8.045a.464.464 0 0 0-.017-.657z"></path></svg>';
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text || !currentChat) return;
            
            const messageRef = database.ref(`messages/${currentChat}`).push();
            const message = {
                id: messageRef.key,
                text: text,
                senderId: currentUser.id,
                timestamp: Date.now(),
                status: 'sent'
            };
            
            messageRef.set(message);
            
            // Update chat
            const otherUserId = currentChat.split('_').find(id => id !== currentUser.id);
            database.ref(`chats/${currentChat}`).update({
                lastMessage: message,
                [`unread/${otherUserId}`]: firebase.database.ServerValue.increment(1)
            });
            
            // Clear typing
            database.ref(`typing/${currentChat}/${currentUser.id}`).remove();
            
            input.value = '';
        }

        function handleKeyPress(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        }

        function handleTyping() {
            if (!currentChat) return;
            
            database.ref(`typing/${currentChat}/${currentUser.id}`).set(true);
            
            clearTimeout(typingTimeout);
            typingTimeout = setTimeout(() => {
                database.ref(`typing/${currentChat}/${currentUser.id}`).remove();
            }, 2000);
        }

        function listenForTyping(chatId, otherUserId) {
            database.ref(`typing/${chatId}/${otherUserId}`).on('value', (snapshot) => {
                const indicator = document.getElementById('typingIndicator');
                if (snapshot.val()) {
                    indicator.classList.remove('hidden');
                } else {
                    indicator.classList.add('hidden');
                }
            });
        }

        function showNewChat() {
            document.getElementById('newChatModal').classList.remove('hidden');
        }

        function hideNewChat() {
            document.getElementById('newChatModal').classList.add('hidden');
            document.getElementById('newChatPhone').value = '';
        }

        function startNewChat() {
            const phone = document.getElementById('newChatPhone').value.trim().replace(/\D/g, '');
            
            if (!phone) {
                alert('Digite um número de telefone');
                return;
            }

            const chatId = getChatId(currentUser.id, phone);
            
            // Create chat if not exists
            database.ref(`chats/${chatId}`).once('value', (snapshot) => {
                if (!snapshot.exists()) {
                    database.ref(`chats/${chatId}`).set({
                        participants: {
                            [currentUser.id]: true,
                            [phone]: true
                        },
                        createdAt: Date.now()
                    });
                }
                
                const otherUser = users[phone] || { id: phone, name: phone, avatar: phone.charAt(0) };
                hideNewChat();
                openChat(chatId, otherUser);
            });
        }

        function closeChat(e) {
            e.stopPropagation();
            currentChat = null;
            document.getElementById('chatView').classList.add('hidden');
            document.getElementById('emptyState').classList.remove('hidden');
            renderChatsList();
        }

        function searchChats() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const items = document.querySelectorAll('#chatsList > div');
            
            items.forEach(item => {
                const name = item.querySelector('.text-white')?.textContent.toLowerCase() || '';
                item.style.display = name.includes(query) ? 'flex' : 'none';
            });
        }

        // Utility functions
        function formatTime(timestamp) {
            return new Date(timestamp).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
        }

        function formatDate(timestamp) {
            const date = new Date(timestamp);
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            if (date.toDateString() === today.toDateString()) return 'Hoje';
            if (date.toDateString() === yesterday.toDateString()) return 'Ontem';
            return date.toLocaleDateString('pt-BR');
        }

        function formatLastSeen(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'agora';
            if (diff < 3600000) return `há ${Math.floor(diff / 60000)} min`;
            if (date.toDateString() === now.toDateString()) return `hoje às ${formatTime(timestamp)}`;
            return `${formatDate(timestamp)} às ${formatTime(timestamp)}`;
        }

        function toggleMenu() {
            // Menu toggle logic
        }

        function showContactInfo() {
            // Contact info modal
        }
    </script>
</body>
</html>
